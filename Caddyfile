{
  email admin1@xuniverz.com
}

astrooverz.com, www.astrooverz.com {
  encode zstd gzip

  # API routes - proxy to FastAPI backend
  handle /api/* {
    reverse_proxy backend:8000 {
      health_uri /healthz
      health_interval 30s
    }
  }

  # Health check routes
  handle /healthz {
    reverse_proxy backend:8000
  }

  handle /health {
    reverse_proxy backend:8000
  }

  # all other requests hit the frontend
  handle {
    reverse_proxy frontend:80
  }
}

api.astrooverz.com {
  encode zstd gzip

  # API routes - proxy to FastAPI backend with /api prefix
  handle /api/* {
    reverse_proxy backend:8000 {
      health_uri /healthz
      health_interval 30s
    }
  }

  # Health check routes
  handle /healthz {
    reverse_proxy backend:8000
  }

  handle /health {
    reverse_proxy backend:8000
  }

  # All other requests go to frontend
  handle {
    reverse_proxy frontend:80
  }
}

# Local development configuration
localhost, 127.0.0.1 {
  encode zstd gzip

  # API routes - proxy to FastAPI backend
  handle /api/* {
    reverse_proxy backend:8000 {
      health_uri /healthz
      health_interval 30s
    }
  }

  # Health check routes
  handle /healthz {
    reverse_proxy backend:8000
  }

  handle /health {
    reverse_proxy backend:8000
  }

  # all other requests hit the frontend
  handle {
    reverse_proxy frontend:80
  }
}

# Development configuration (fallback)
:80, :443 {
  encode zstd gzip

  # API routes - proxy to FastAPI backend
  handle /api/* {
    reverse_proxy backend:8000 {
      health_uri /healthz
      health_interval 30s
    }
  }

  # Health check routes
  handle /healthz {
    reverse_proxy backend:8000
  }

  handle /health {
    reverse_proxy backend:8000
  }

  # all other requests hit the frontend
  handle {
    reverse_proxy frontend:80
  }
}